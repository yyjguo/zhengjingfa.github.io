<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sybase SQL Server相关 | Afanail</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="– DDL数据定义：创建和定义数据库中的对象，表 关键字 视图 规则 默认值 存储过程 触发器 临时表1234Create TableCreate ViewDrop TableDrop View –DML数据操作语言，操作数据库中的对象和数据12345selectdeleteinsertexecute 执行存储过程update –DCL数据控制语句，赋予用于访问数据库对象的权限，系统管理员具有使用">
<meta name="keywords" content="sql sybase">
<meta property="og:type" content="article">
<meta property="og:title" content="Sybase SQL Server相关">
<meta property="og:url" content="http://www.afanail.com/2017/10/21/sql/index.html">
<meta property="og:site_name" content="Afanail">
<meta property="og:description" content="– DDL数据定义：创建和定义数据库中的对象，表 关键字 视图 规则 默认值 存储过程 触发器 临时表1234Create TableCreate ViewDrop TableDrop View –DML数据操作语言，操作数据库中的对象和数据12345selectdeleteinsertexecute 执行存储过程update –DCL数据控制语句，赋予用于访问数据库对象的权限，系统管理员具有使用">
<meta property="og:updated_time" content="2017-12-10T01:40:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sybase SQL Server相关">
<meta name="twitter:description" content="– DDL数据定义：创建和定义数据库中的对象，表 关键字 视图 规则 默认值 存储过程 触发器 临时表1234Create TableCreate ViewDrop TableDrop View –DML数据操作语言，操作数据库中的对象和数据12345selectdeleteinsertexecute 执行存储过程update –DCL数据控制语句，赋予用于访问数据库对象的权限，系统管理员具有使用">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.afanail.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Afanail</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-sql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/21/sql/" class="article-date">
  <time datetime="2017-10-21T03:14:20.000Z" itemprop="datePublished">2017-10-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Sybase SQL Server相关
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>– DDL数据定义：创建和定义数据库中的对象，表 关键字 视图 规则 默认值 存储过程 触发器 临时表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">Table</span></div><div class="line"><span class="keyword">Create</span> <span class="keyword">View</span></div><div class="line"><span class="keyword">Drop</span> <span class="keyword">Table</span></div><div class="line"><span class="keyword">Drop</span> <span class="keyword">View</span></div></pre></td></tr></table></figure></p>
<p>–DML数据操作语言，操作数据库中的对象和数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span></div><div class="line"><span class="keyword">delete</span></div><div class="line"><span class="keyword">insert</span></div><div class="line"><span class="keyword">execute</span> 执行存储过程</div><div class="line"><span class="keyword">update</span></div></pre></td></tr></table></figure></p>
<p>–DCL数据控制语句，赋予用于访问数据库对象的权限，系统管理员具有使用DCL命令的最高权限，有权使用所有数据库对象。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">grant</span>    授权</div><div class="line"><span class="keyword">revoke</span>   回收权限</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>– 打开一个数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> database_name;</div><div class="line"><span class="keyword">select</span> select_list <span class="keyword">from</span> database_name <span class="keyword">where</span> search_conditions <span class="keyword">group</span> <span class="keyword">by</span> aggregates_free_expression <span class="keyword">having</span> search_condition <span class="keyword">order</span> <span class="keyword">by</span> column_name;</div><div class="line"></div><div class="line"><span class="keyword">select</span> pub_name,state <span class="keyword">from</span> publishers;</div><div class="line"></div><div class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> staste <span class="keyword">from</span> <span class="keyword">authors</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> pub_name ,<span class="string">"的ID号是"</span>,pub_id <span class="keyword">from</span> publishers;</div><div class="line"></div><div class="line"><span class="keyword">select</span> au_id,au_lname,au_fname <span class="keyword">from</span> <span class="keyword">authors</span> <span class="keyword">where</span> state=<span class="string">"UT"</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> title,price*total_sales <span class="keyword">from</span> titles <span class="keyword">where</span> price*total_sales&gt;<span class="number">75000</span> <span class="keyword">order</span> <span class="keyword">by</span> title <span class="keyword">desc</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> au_id,au_fname,au_lname <span class="keyword">from</span> <span class="keyword">authors</span> <span class="keyword">where</span> state <span class="keyword">in</span>(<span class="string">"CA"</span>,<span class="string">"WA"</span>,<span class="string">"MD"</span>);</div><div class="line"></div><div class="line"><span class="keyword">select</span> au_id,au_fname,au_lname <span class="keyword">from</span> <span class="keyword">authors</span> <span class="keyword">where</span> staste <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">"CA"</span>);</div></pre></td></tr></table></figure></p>
<p>– sql 的四个通配符为，必须在引号内，like, not like<br>      – % 匹配0到多个字符的字符串<br>      – _ 匹配单个字符<br>      – [] 匹配给定范围内的任一个字符<br>      – [^] 匹配不含在给定范围的单个字符<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> pub_name <span class="keyword">from</span> <span class="keyword">authors</span> pub_name <span class="keyword">like</span> <span class="string">"B%Y"</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> au_fname <span class="keyword">from</span> <span class="keyword">authors</span> <span class="keyword">where</span> au_fname <span class="keyword">like</span> <span class="string">"__i%"</span>;</div><div class="line"></div><div class="line"><span class="comment">--查询某一范围内的信息</span></div><div class="line"><span class="keyword">select</span> title <span class="keyword">from</span> title <span class="keyword">where</span> price&lt;<span class="number">15</span> <span class="keyword">or</span> price&gt;<span class="number">20</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> title <span class="keyword">from</span> titles <span class="keyword">where</span> price <span class="keyword">not</span> <span class="keyword">between</span> <span class="number">15</span> <span class="keyword">and</span> <span class="number">20</span>;</div><div class="line"></div><div class="line"><span class="comment">--union 子句，将俩个以上的查询结果合并成一个单一的结果。将不同的集组合成为一个单一的结果返回给客户机程序。每一个select语句所得到的数据类型必须是相同的。</span></div><div class="line"></div><div class="line"><span class="keyword">select</span> title <span class="keyword">from</span> titles <span class="keyword">where</span> price*total_sales&gt;<span class="number">1000</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> pub_name <span class="keyword">from</span> publishers;</div><div class="line"></div><div class="line"><span class="keyword">select</span> au_lname <span class="keyword">from</span> <span class="keyword">authors</span> <span class="keyword">where</span> au_lname <span class="keyword">like</span> <span class="string">"D%"</span>;</div></pre></td></tr></table></figure></p>
<p>– title pub_name au_lname 类型相同，可以使用union子句将这三个结果集合组成一个单一的结果集。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> title <span class="keyword">from</span> titles <span class="keyword">where</span> price*total_sales&gt;<span class="number">10000</span></div><div class="line"><span class="keyword">union</span></div><div class="line"><span class="keyword">select</span> pub_name <span class="keyword">from</span></div><div class="line">publishers </div><div class="line"><span class="keyword">union</span></div><div class="line"><span class="keyword">select</span> au_lname <span class="keyword">from</span></div><div class="line"><span class="keyword">authors</span> <span class="keyword">where</span></div><div class="line">au_lname <span class="keyword">like</span> <span class="string">"D%"</span>;</div></pre></td></tr></table></figure></p>
<p>– union列标题以第一个查询结果为准<br>– 使用多表查询，表名和视图名可以是俩个或者俩个以上（最多可达16个）。<br>–（相等连接）<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> au_fname,au_lname,pub_name <span class="keyword">from</span> <span class="keyword">authors</span>,publishers  <span class="keyword">where</span> authors.city=publishers.city;</div><div class="line"><span class="keyword">select</span> t.title,a.au_lname,a.au_fname <span class="keyword">from</span> <span class="keyword">authors</span> a,titles t,titleauthor ta </div><div class="line"><span class="keyword">where</span> a.au_id=ta.au_id</div><div class="line"><span class="keyword">and</span> ta.title_id=t.title_id</div><div class="line"><span class="keyword">and</span> t.price&gt;<span class="number">20</span>;</div></pre></td></tr></table></figure></p>
<p>– insert 向表中输入数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> table_name(column_name1,column_name2)   <span class="keyword">values</span> (values1,values2);</div></pre></td></tr></table></figure></p>
<p>– 列的个数必须与values子句中的个数相同；值的数据类型必须和列的数据类型相对应，values子句中的顺序必须和表中的顺序保持一致。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> publishers(pub_id,pub_name,city,staste) <span class="keyword">values</span>(<span class="string">"9999"</span>,<span class="string">"QUE Cororation"</span>,<span class="string">"Indianapolis"</span>,<span class="string">"IN"</span>);</div></pre></td></tr></table></figure></p>
<p>– 允许省略列的清单，values子句中值的顺序必须和表中列的顺序保持一致，个数一致，数据类型相同。否则Sybase拒绝插入数据。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> stores <span class="keyword">values</span>(<span class="string">"9999"</span>,<span class="string">"The QUE Bookstop"</span>,<span class="string">"1701 MCP Avenue"</span>,<span class="string">"Indianaplis"</span>,<span class="string">"IN"</span>,<span class="string">"USA"</span>,<span class="string">"37012"</span>,<span class="string">"net120"</span>);</div></pre></td></tr></table></figure></p>
<p>– update修改表中的数据，修改表中一列或者多列的值,如果省略where子句，将修改表中的所有行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> table_name <span class="keyword">set</span> column_name=expression</div><div class="line"><span class="keyword">where</span> expression;</div></pre></td></tr></table></figure></p>
<p>–当对表 修改失败时，不会得到Sybase给出的信息，因为这不是一个错误，如果想要知道数据是否被修改，比较简单的方法是使用查询语句查看<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">update</span> <span class="keyword">authors</span> <span class="keyword">set</span> au_lname=<span class="string">"flagstaff"</span> <span class="keyword">where</span> au_id=<span class="string">"238-95-7766"</span>;</div></pre></td></tr></table></figure></p>
<p>–delete 语句用来从表中删除数据。要小心，它将数据从表中永久删除。需要从备份中恢复。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> search_condition;</div><div class="line"></div><div class="line"><span class="keyword">delete</span> publishers <span class="keyword">where</span> pub_id=<span class="string">"9999"</span>;</div></pre></td></tr></table></figure></p>
<p>– 文法规定 </p>
<pre><code>{}必须至少选其中的一个选项。[]可选可不选
--标识符1-30个字符组成，第一字符可以是字母（A-Z，a-z) 或@ #其他字符可以是字母 数字 或符合 $ # _,@表示一个局部变量，列名和索引名必须是唯一的。

-- 存储过程可以在远程的SQL服务器上运行，其运行结果可显示在调用该过程的终端上。

declare @var int 
exec gateway...gyroyalty;

-- 数据类型用来说明表列 存储过程参数及局部变量的数据特征，即数据的长度 存储格式等。

-- 在存储过程使用参数之前，必须先定义参数的数据类型和数据的长度。

-- 在存储过程中使用参数之前，必须先定义参数的数据类型和数据的长度。

-- 数值型 整型、浮点型、货币型
-- 字符型数据类型 char(n)为定长字符型。输入的字符数据必须用单引号或者双引号括起来。输入数据的超长部分被截断，不足部分系统自动用空格补足。
-- varcha(n)为可变长度的字符型。n为字节数，其值为1-255之间，n表示该类型数据的最大长度。其存储长度为输入的数据值的实际长度，超长部分将被截断，空字符串 &quot; &quot;作为空格存储。

-- nchar(n)多字节字符集
-- nvarchar

-- text 文本型，只能用于说明表的列类型，不能用于局部变量或存储过程参数。允许空值，可用于表示可变长度的列。

-- datetime 显示当前服务器的名称为
-- select getdate()

-- binary(n) 二进制型，长度为n字节，n必须在1——255之间。必须在输入的第一个二进制值前面加0X。
-- varbinary(n) 变长二进制型，存储数据慢，所占空间小

-- bit timestamp image
-- bit only 0 and 1,logic and not null and not index. not 1 defalut 1
-- timestamp 数据类型，向表中插入一行数据时，timestamp类型的列值自动进行计数，不能手动输入timestamp列的值，该值varbinary（8）格式进行存储，且在表中是唯一的。
-- image 为图像型。只能用来说明表的列类型，但不能用于局部变量和存储过程中的参数。允许空值。
</code></pre><p>– 2.用户定义的数据类型：用户定义的数据类型是在系统数据类型的基础上定义的，实际上是对常用系统数据类型的重新定义。目的：使用户可以用名字来存取经常使用的类型和长度信息。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">-- sp_addtype typename,systype[(length)][,nulltype]</span></div><div class="line"></div><div class="line">sp_addtype dbname1,"char(20)","not null";</div><div class="line"></div><div class="line">sp_addtype dbname2,"varchar(10)","null";</div></pre></td></tr></table></figure></p>
<p>– 用户数据类型被成功定义，就会自动加入到系统表中，使我们可以像使用系统数据类型一样使用它。</p>
<p>– sp_help 显示用户定义的数据类型。</p>
<p>– sp_droptype dbname1 删除用户自定义类型dbname1;</p>
<p>– sybase 局部变量用户自定义的变量，全局变量是Sybase定义的变量</p>
<p>– 局部变量 declare定义局部变量,不能与Sybase的全局变量同名，其数据类型可以是系统数据类型，也可以是用户定义的类型。但不能是text和image类型。刚定义的局部变量在未赋值之前其值为null（空）。使用select语句可以对局部变量进行赋值</p>
<pre><code>-- declare @variale_name datatype
-- select @variable_name=expression [,@variable_name=expression]...[from...][where...];该语句只能给局部变量赋值，且不显示结果。
declare @var1 int,@var2 money
select @val1=-68,@var2=97.564;
</code></pre><p>– 局部变量只能在定义他的批处理 存储过程或触发器中使用，否则无效。</p>
<p>– 以下几种情况使用局部变量：</p>
<pre><code>-- 1 在while循环语句中，用于循环计数
-- 2 在if_else语句中，用于条件判断
-- 3 向存储过程传递参数或者接收从存储过程中返回的信息。
-- 4 向客户应用程序返回标准信息的同时，返回不同的客户信息。
</code></pre><p>– 全局变量</p>
<pre><code>-- Sybase定义的变量。全局变量以@@开始，如@@error
-- 全局变量只能出现在常量出现的地方。
</code></pre><p>– 函数： 系统函数 统计函数 字符串函数 数学函数 日期函数 数据类型转换函数 文本和图像函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">declare</span> @i1 <span class="built_in">int</span>,@isum <span class="built_in">int</span></div><div class="line"><span class="keyword">select</span> @i1=<span class="number">1</span>,@isum=<span class="number">0</span></div><div class="line"><span class="keyword">while</span> @i1&lt;=<span class="number">1000</span></div><div class="line"><span class="keyword">begin</span></div><div class="line">    <span class="keyword">select</span> @isum=@isum+@i1</div><div class="line">    <span class="keyword">select</span> @i1=@i1+<span class="number">1</span></div><div class="line">    <span class="keyword">if</span> @i1&gt;<span class="number">1000</span></div><div class="line">    <span class="keyword">select</span> @isum</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>– 一个实体对应一张表，实体的一个属性就是表中的一列，实体的一个实例就是表中的一行，实体间的关系表现为表的关联。表是关系型数据库的最基本的概念，是数据存储和加工的场所。</p>
<p>– 关键字 primary key 主键 表中的一个列或者多个列组成。主键能唯一的识别表中的每一行。不能为空，外键描述一个表与其他表的关系<br>–       foreign key 外键 能表示另一个表的主键。实际上外键本身是主键的拷贝。</p>
<p>– system tables 文件夹中</p>
<p>– 数据库的完整性就是数据的正确性和一致性，它反映了现实世界中实体的本来面貌。完整性分为数据完整性和参照完整性。</p>
<p>– 一个表满足数据的完整性，是说该表的任一行数据都是实体的一个合法的实例，而且这种合法性的验证不涉及系统中的其他表的数据。</p>
<p>– 参照完整性：表与表之间的关系而言的。俩个表的数据是一致的协调的，俩个表的主关键字外关键字也是一致协调的。教师表中教师ID一定在教师表中存在，对教师表中的某个教师ID进行修改删除时，若这个教师ID在教师课程表中存在，则不允许修改删除，或要求同时修改删除教师课程表中的教师ID，否则这俩个表中的一致性就受到了破坏，也就不难报障俩表的参照完整性。Sybase提供了一系列手段来报障完整性，如数据类型，规则，默认值，唯一索引和触发器等。</p>
<p>– 数据库的组成，在Sybase数据库中，含有表（tables）视图（views）索引（indexs)规则（rules）默认值（defaults)用户定义数据类型（user-defined datatype)存储过程（stored procedures)触发器（triggers)等数据库对象。</p>
<p>– 表是Sybase的核心，别的对象均是围绕表而创建的，他们从不同的角度扩充了表的功能。</p>
<p>– 表由行和列组成，它要满足关系型数据库的最基本要求：表中的所有属性（列）都是不可再分的基本数据项。</p>
<p>– database device、 dump device</p>
<p>– 使用SQL命令创建数据库设备<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">disk init   <span class="comment">/*初始化命令*/</span></div><div class="line">name="mydev2",<span class="comment">/* database device logic name*/</span></div><div class="line">physname="e:\device\mydev2.dat",<span class="comment">/*database device physical name*/</span></div><div class="line">vdevno=2,<span class="comment">/* database device number*/</span></div><div class="line">size=1024<span class="comment">/* 2MB block 1block=2kb*/</span></div><div class="line">go</div></pre></td></tr></table></figure></p>
<p>– 临时表名不应该超过13个字符包括#，因为SQL server另给临时表名加一个内部的数字后缀。</p>
<p>– 临时表的优点是，在临时数据库tempdb上执行操作时不记录日志，能提高系统性能。临时表通常用来保存中间结果。只有在创建它的会话中才可能访问临时表。在当前会话期结束时临时表会被自动删除，用户可以使用drop Table命令删除临时表。所有用户均可以创建临时表。用户定义的数据类型不能用于临时表，除非该数据类型已经tempdb中存在。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> #temptable</div><div class="line">(task <span class="built_in">char</span>(<span class="number">30</span>)),</div><div class="line"><span class="keyword">start</span> datetime,</div><div class="line"><span class="keyword">stop</span> datetime,</div><div class="line">notes <span class="built_in">varchar</span>(<span class="number">200</span>)</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– sybase 不允许从一个已存在的表中删除列，我们可以采用其他的方法。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> newtab(au_id <span class="keyword">id</span> <span class="keyword">not</span> <span class="literal">null</span>,au_lname <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">not</span> <span class="literal">null</span>)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> newtab(au_id,au_lname) <span class="keyword">values</span>(<span class="keyword">select</span> au_id,au_lname <span class="keyword">from</span> <span class="keyword">authors</span>)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">authors</span></div><div class="line"><span class="keyword">go</span> </div><div class="line">sp_rename newtab,<span class="keyword">authors</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 只有表的所有者才能删除表，删除表的权限不能转让。不能删除一个正在使用的表，但是可以删除另一个数据库中的表。不能删除系统表。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--1 sales table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> sales</div><div class="line">(stor_id <span class="built_in">char</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">ord_num <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line"><span class="built_in">date</span> datetime <span class="keyword">not</span> <span class="literal">null</span>)</div><div class="line"><span class="keyword">go</span> </div><div class="line"><span class="comment">--2 salesdetail table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> salesdetail</div><div class="line">(stor_id <span class="built_in">char</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">ord_num <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">title_id tid <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">qty <span class="built_in">smallint</span> <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">discount <span class="built_in">float</span> <span class="keyword">not</span> <span class="literal">null</span>)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="comment">--3 titleauthor table</span></div><div class="line"><span class="keyword">use</span> mydatabase </div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> titleauthor</div><div class="line">(au_id <span class="keyword">id</span> <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">title_id tid <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">au_ord tinyint <span class="literal">null</span>,</div><div class="line">royaltyper <span class="built_in">int</span> <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="comment">--4 titles table</span></div><div class="line"><span class="keyword">use</span> mydatabase </div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> titles(</div><div class="line">title_id tid <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">title <span class="built_in">varchar</span>(<span class="number">80</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line"><span class="keyword">type</span> <span class="built_in">char</span>(<span class="number">12</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">pub_id <span class="built_in">char</span>(<span class="number">4</span>) <span class="literal">null</span>,</div><div class="line">price money <span class="literal">null</span>,</div><div class="line">advance money <span class="literal">null</span>,</div><div class="line">total_sales <span class="built_in">int</span> <span class="literal">null</span>,</div><div class="line">notes <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="literal">null</span>,</div><div class="line">pubdate datetime <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">contract <span class="built_in">bit</span> <span class="keyword">not</span> <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span> </div><div class="line"><span class="comment">--5 stores table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> stores</div><div class="line">(stor_id <span class="built_in">char</span>(<span class="number">4</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">stor_name <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="literal">null</span>,</div><div class="line">stor_address <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="literal">null</span>,</div><div class="line">city <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="literal">null</span>,</div><div class="line">state <span class="built_in">char</span>(<span class="number">2</span>) <span class="literal">null</span>,</div><div class="line">country <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="literal">null</span>,</div><div class="line">postalcode <span class="built_in">char</span>(<span class="number">10</span>) <span class="literal">null</span>,</div><div class="line">payterms <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="comment">--6 discount table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> discount</div><div class="line">(</div><div class="line">discounttype <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">stor_id <span class="built_in">char</span>(<span class="number">4</span>) <span class="literal">null</span>,</div><div class="line">lowqty <span class="built_in">smallint</span> <span class="literal">null</span>,</div><div class="line">highqty <span class="built_in">smallint</span> <span class="literal">null</span>,</div><div class="line">discount <span class="built_in">float</span> <span class="keyword">not</span> <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div><div class="line"></div><div class="line"><span class="comment">-- au_pjx table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> au_pix</div><div class="line">(</div><div class="line">au_id <span class="built_in">char</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">pic image <span class="literal">null</span>,</div><div class="line">format_type <span class="built_in">char</span>(<span class="number">11</span>) <span class="literal">null</span>,</div><div class="line">bytesize <span class="built_in">int</span> <span class="literal">null</span>,</div><div class="line">pixwidth_hor <span class="built_in">char</span>(<span class="number">14</span>) <span class="literal">null</span>,</div><div class="line">pixwidth_vert <span class="built_in">char</span>(<span class="number">14</span>) <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div><div class="line"><span class="comment">--8 blurbs table</span></div><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> blurbs(</div><div class="line">au_id <span class="keyword">id</span> <span class="keyword">not</span> <span class="literal">null</span>,</div><div class="line">copy <span class="built_in">text</span> <span class="literal">null</span></div><div class="line">)</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 表的分割：用来解决在表上执行多个并行insert事务时引发的页面竞争问题。<br>– 分割表将产生附加的页链，每个页链都有自己的最后一页。这样并发插入操作可获得多个最后一页，从而减少了页竞争而提高了插入性能。Sybase可以将一个表中的数据分割到多个物理设备上，保证在这些设备上均匀分布数据。段可以将数据库对象存放到不同的物理设备上，通过数据分割同样可以将数据均匀分布在多个物理设备上。</p>
<p>– 分割表可在俩种情况下进行</p>
<pre><code>-- 1在同一个数据库设备上分割表
-- 2在多个数据库设备上分割表
</code></pre><p>–单索引建在一个列上，复合索引创建在多个列上，这些列必须属于同一个表。</p>
<pre><code>-- 1 唯一索引：唯一索引是指不能有俩行相同索引值的索引（包括null）
-- 2 簇式索引：数据在表中的物理存储顺序与索引顺序一致。创建簇式索引的表就是排了序的表。当创建一个簇式索引时，非簇式索引就会被自动创建。
-- 3 非簇式索引：数据行的物理存储顺序与索引顺序不同。一个非簇式索引是一个额外的表。其中包含索引列和一个指针。索引列按索引值的排序，指针则指向数据的实际物理行，一个表中多达249个非簇式索引。
</code></pre><p>–使用簇式索引的数据的查找比使用非簇式索引的数据的查找速度要快。默认会自动生成一个非簇式索引</p>
<p>–四类组合型索引：惟一的簇式索引、惟一的非簇式索引、非惟一的簇式索引、非惟一的非簇式索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> mydatabase</div><div class="line"><span class="keyword">create</span> <span class="keyword">unique</span> clustered <span class="keyword">index</span> pubinx</div><div class="line"><span class="keyword">on</span> publishers(pub_id)</div><div class="line"><span class="keyword">with</span> fillfactor=<span class="number">90</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure>
<p>– 经常使用规则定义表列数据的有效范围，在没有提供某列的值时，插入默认值到数据库中的表列中。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> defalut datedefault</div><div class="line"><span class="keyword">as</span> <span class="keyword">getdate</span>()</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– create rule 语句不能和其他的SQL语句写在同一个批处理中。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">view</span> stateview2</div><div class="line"><span class="keyword">as</span> <span class="keyword">select</span> au_id,au_lname <span class="keyword">from</span> </div><div class="line"><span class="keyword">authors</span> <span class="keyword">where</span> state=<span class="string">"CA"</span>;</div><div class="line"></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> stateview2 <span class="keyword">go</span></div><div class="line"></div><div class="line"><span class="keyword">create</span> <span class="keyword">view</span> pubview</div><div class="line"><span class="keyword">as</span></div><div class="line">    <span class="keyword">select</span> *</div><div class="line">    <span class="keyword">from</span> publishers</div><div class="line">    <span class="keyword">where</span> city=<span class="string">"Boston"</span></div><div class="line"><span class="keyword">go</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">create</span> <span class="keyword">view</span> typegroup</div><div class="line"><span class="keyword">as</span> </div><div class="line">    <span class="keyword">select</span> <span class="keyword">type</span>,<span class="keyword">count</span>(*)</div><div class="line">    <span class="keyword">from</span> titles </div><div class="line">    <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">type</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 只能在那些不含有结果数据或函数结果的视图的列上执行insert update delete操作</p>
<p>– 存储过程是SQL语句和流程控制语句的集合。有俩种存储过程：系统存储过程和用户定义的存储过程。系统存储过程以sp_开始。</p>
<p>– 创建存储过程<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">procedure</span> pro_publishers</div><div class="line"><span class="keyword">as</span> </div><div class="line"><span class="keyword">select</span> *</div><div class="line"><span class="keyword">from</span> </div><div class="line">publishers</div><div class="line"><span class="keyword">go</span></div><div class="line">pro_publishers</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 使用一个输入参数查找特定作者<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> pro_authorInfo</div><div class="line">@psauthorID <span class="built_in">char</span>(<span class="number">11</span>)</div><div class="line"><span class="keyword">as</span></div><div class="line"><span class="keyword">select</span> *</div><div class="line"><span class="keyword">from</span> <span class="keyword">authors</span></div><div class="line"><span class="keyword">where</span> au_id=@psauthorID</div><div class="line"><span class="keyword">return</span> <span class="number">0</span></div><div class="line"><span class="keyword">go</span></div><div class="line">pro_authorInfo <span class="string">"172-32-1176"</span>;</div><div class="line"><span class="comment">-- 在参数中赋予默认值</span></div><div class="line"><span class="keyword">Create</span> <span class="keyword">procedure</span> pro_newauthorInfo</div><div class="line">@psauthorID <span class="built_in">char</span>(<span class="number">11</span>)=<span class="string">"172-32-1176"</span></div><div class="line"><span class="keyword">as</span></div><div class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">authors</span></div><div class="line"><span class="keyword">where</span> au_id=@psauthorID</div><div class="line"><span class="keyword">return</span> <span class="number">0</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 使用输出参数output，创建一个能进行俩个数学运算的存储过程。<br>– 1 up_DoMath<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> up_DoMath</div><div class="line">@psOperator <span class="built_in">varchar</span>(<span class="number">12</span>),</div><div class="line">@pnFirstNumber <span class="built_in">int</span>,</div><div class="line">@pnSecondNumber <span class="built_in">int</span>,</div><div class="line">@rnResult <span class="built_in">int</span> <span class="keyword">output</span> <span class="comment">/*存放俩数运算结果*/</span></div><div class="line"><span class="keyword">as</span></div><div class="line">print <span class="string">"compute right now."</span></div><div class="line"><span class="keyword">if</span> @psOperator=<span class="string">"Multiply"</span></div><div class="line">    <span class="keyword">begin</span></div><div class="line">        <span class="keyword">select</span> @rnResult=@pnFirstNumber*@pnSecondNumber</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> @psOperator=<span class="string">"ADD"</span></div><div class="line">    <span class="keyword">begin</span> </div><div class="line">        <span class="keyword">select</span> </div><div class="line">        @rnResult=@pnFirstNumber+@pnSecondNumber</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> @psOperator=<span class="string">"Subtract"</span></div><div class="line">    <span class="keyword">begin</span></div><div class="line">        <span class="keyword">select</span></div><div class="line">        @rnResult=@pnFirstNumber-@pnSecondNumber</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> @psOperatoro=<span class="string">"Divide"</span></div><div class="line">    <span class="keyword">begin</span></div><div class="line">        <span class="keyword">select</span> </div><div class="line">        @rnResult=@pnFirstNumber/@pnSecondNumber</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">else</span> </div><div class="line">    <span class="keyword">begin</span></div><div class="line">    <span class="comment">/* error info*/</span></div><div class="line">    <span class="keyword">select</span> @rnResult=<span class="number">0</span></div><div class="line">    <span class="keyword">return</span> <span class="number">-99</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">return</span> <span class="number">0</span></div><div class="line"><span class="keyword">go</span></div><div class="line"></div><div class="line"><span class="comment">-- 2 procedure up_Multiply</span></div><div class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> up_Multiply</div><div class="line">@pnFirstNumber <span class="built_in">int</span>,</div><div class="line">@pnSecondNumber <span class="built_in">int</span></div><div class="line"><span class="keyword">as</span></div><div class="line"><span class="keyword">declare</span> @nRC <span class="built_in">int</span>,</div><div class="line">        @nMathResult <span class="built_in">int</span></div><div class="line">print <span class="string">"compute now"</span></div><div class="line">exec up_DoMath <span class="string">"Multiply"</span>,@pnFirstNumber,@pnSecondNumber,</div><div class="line">@nMathResult <span class="keyword">output</span></div><div class="line"><span class="keyword">select</span> @nMathResult</div><div class="line"><span class="keyword">return</span> <span class="number">0</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 可以从以下几种调用程序中来执行存储过程：</p>
<pre><code>-- 一个存储过程
-- 一个批命令
-- 一个触发器
-- 一段client-library DB-Library程序
-- 写入一个客户、服务器开发工具中的任意程序
</code></pre><p>– 如果调用执行另一过程的存储过程，被调用过程就能存取调用过程所创建的对象，过程嵌套限制为16层。超过16层的嵌套就会导致事务失败。系统失败状态-1~-99之间，用户可以在范围之外定义自己的返回状态值</p>
<p>– 触发器 trigger 是一种特殊的存储过程。在对表进行插入 删除 修改操作时，它起作用。触发器通过维持不同表中逻辑上相关数据的一致性，保证数据的参照完整性。参照完整性是指主键值与相应的外键值必须完全匹配。</p>
<p>– 触发器的主要优点是：当数据变化时，他们能够自动响应，而不管是录入数据还是应用程序的影响。它专用一个数据的更新操作。对于这样的SQL语句，触发器执行一次（在数据更新语句完成后立即被触发）。触发器和触发它的语句被当作一个事务处理，事务可以在触发器中回退。</p>
<p>– 主表从表。外键值。</p>
<p>– 外键对主键经常是多对一的关系。</p>
<p>– 触发器的工作<br>    – 参照完整性触发器保证外键的值与主键的值一致，当数据更新影响一个键列时，触发器通过临时触发器检查表比较新的列值与相应键的值。编写触发器时，被比较的数据存放在临时触发器检查表中。</p>
<p>– 编写触发器，用到俩个特殊的表，deleted和inserted表。这是俩个临时表。这俩个表用来检查一些数据更新的影响并为触发器动作设置条件。不能直接改变触发器检查表中的数据，但是能够使用select语句来检测insert update delete操作带来的影响。<br>– 创建触发器 修改触发器 删除触发器 条件插入触发器的具体使用。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">trigger</span> trigger_name <span class="keyword">on</span> table_name <span class="keyword">for</span>&#123;<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span>&#125;</div><div class="line"><span class="keyword">as</span> sql_statement;</div></pre></td></tr></table></figure></p>
<p>– table_name 为激活触发器的表名，该表有时被称为触发表。触发器只能在当前数据库中创建。<br>– SQL_statement 为激活触发器后要执行的一段程序，触发条件是insert update 和 delete，如果要执行多个SQL语句组成，则必须用begin和end语句括起来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> newtri_author <span class="keyword">on</span> dbo.authors <span class="keyword">for</span> <span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">delete</span> <span class="keyword">as</span></div><div class="line">print <span class="string">"正在对authors表进行数据处理"</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure>
<p>– 一个表最多可有3个触发器：insert触发器 update触发器和delete触发器。也可以建立一个触发器，用在insert update delete这3个操作上，此时只能建立一个，后建立的触发器将覆盖先建立的触发器。</p>
<p>– updated 语句执行期间，被修改的行从触发器表拷贝到deleted表中。</p>
<p>– 下面介绍创建触发器 修改触发器 删除触发器 和条件插入触发器的具体使用。</p>
<p>– authors 表进行insert操作的语句如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">insert</span> <span class="keyword">authors</span> <span class="keyword">values</span>(<span class="string">"333-22-111"</span>,<span class="string">"zhang"</span>,<span class="string">"xiamei"</span>,<span class="string">"408 286-2428"</span>,<span class="string">"22Cle"</span>,,<span class="string">"san"</span>,<span class="string">"ca"</span>,<span class="string">"usa"</span>,<span class="string">"95123"</span>)</div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 执行该语句，触发器被触发，显示“正在对authors表进行数据处理”的信息。</p>
<p>– 因为创建的是insert update delete触发器，当对表进行update delete操作时，也会触发tri_author触发器。</p>
<p>– 触发器特别有用，因为他们能强制施加参照完整性，保证数据在表中的合法性。<br>// 下午和小莫不能那样说，应该说这种写法和特别，别具风格。<br>– 数据在输入表之前已合法化。在titleauthor表上创建insert触发器。sql语句为：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Create</span> <span class="keyword">trigger</span> tri_insert </div><div class="line"><span class="keyword">on</span> titleauthor <span class="keyword">for</span> <span class="keyword">insert</span> </div><div class="line"><span class="keyword">as</span></div><div class="line"><span class="keyword">if</span>(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">authors</span>,inserted <span class="keyword">where</span> authors.au_id=inserted.au_id)!=@@rowcount</div><div class="line">    <span class="keyword">begin</span></div><div class="line">        <span class="keyword">rollback</span> <span class="keyword">transaction</span>    <span class="comment">/*回滚事务*/</span></div><div class="line">        print <span class="string">"au_id 号在authors表中不存在."</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">else</span> </div><div class="line">    print <span class="string">"已成功，因为au_id在表中存在。"</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure></p>
<p>– 因为主键是行及其他表外键的唯一标识，所以修改主键要格外小心。一般来说最好禁止对主键的修改。但是如果只是想在某些情况下禁止修改，那么可以使用update触发器。</p>
<p>– 禁止在周末修改authors表的au_id列<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_update_auid</div><div class="line"><span class="keyword">on</span> <span class="keyword">authors</span></div><div class="line"><span class="keyword">for</span> <span class="keyword">update</span></div><div class="line"><span class="keyword">as</span></div><div class="line"><span class="comment">/* 如果修改au_id列，并且是在周末修改的，则回退事务，显示信息。*/</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">update</span>(au_id) <span class="keyword">and</span> <span class="keyword">datename</span>(dw,<span class="keyword">getdate</span>()) <span class="keyword">in</span> (<span class="string">"saturday"</span>,<span class="string">"sunday"</span>)</div><div class="line">    <span class="keyword">begin</span> </div><div class="line">        <span class="keyword">rollback</span> <span class="keyword">transaction</span></div><div class="line">        print <span class="string">"对不起，不允许在周末修改authors表的主键！"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">go</span></div><div class="line"></div><div class="line"><span class="comment">-- if update 子句检查对指定列的插入或修改操作。</span></div><div class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_name <span class="keyword">for</span></div><div class="line">&#123;<span class="keyword">insert</span>,<span class="keyword">update</span>&#125; <span class="keyword">as</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">update</span>(column_name)</div><div class="line">[&#123;<span class="keyword">and</span>|<span class="keyword">or</span>&#125; <span class="keyword">update</span>(column_name)&#125;]...</div><div class="line"><span class="keyword">sql</span> statement.</div><div class="line"></div><div class="line"><span class="comment">-- 因为已经在创建触发器的 on 子句中指定了表名，所以if update子句中不需要在列名前使用表名。</span></div></pre></td></tr></table></figure></p>
<p>2– 外键的update触发器</p>
<pre><code>某些原因要修改外键，允许在外键上创建update触发器。那么外键上的update触发器要根据主表检查所有的修改并且当他们与主键不匹配时回退他们。触发器检查俩种可能失败的原因是：1.所修改的外键在自身的表中不存在。2.外键在主表中不存在。
</code></pre><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">-- 给titleauthor表中的au_id列创建update触发器</span></div><div class="line"> <span class="keyword">Create</span> <span class="keyword">trigger</span> tri_update_titleauthor</div><div class="line"> <span class="keyword">on</span> titleauthor</div><div class="line"> <span class="keyword">for</span> <span class="keyword">update</span></div><div class="line"> <span class="keyword">as</span></div><div class="line">    <span class="keyword">declare</span> @<span class="keyword">row</span> <span class="built_in">int</span> <span class="comment">/*存储修改的行数*/</span></div><div class="line">    <span class="keyword">select</span> @<span class="keyword">row</span>=@@RowCount</div><div class="line">    <span class="keyword">if</span> <span class="keyword">update</span>(au_id)</div><div class="line">    <span class="keyword">begin</span></div><div class="line">      <span class="keyword">if</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> inserted.au_id <span class="keyword">from</span> inserted) <span class="keyword">is</span> <span class="literal">null</span></div><div class="line">        <span class="keyword">begin</span></div><div class="line">          <span class="keyword">rollback</span> <span class="keyword">transaction</span></div><div class="line">          print <span class="string">"对不起，这个au_id在titleauthor表中不存在。"</span></div><div class="line">        <span class="keyword">end</span></div><div class="line">      <span class="keyword">else</span></div><div class="line">        <span class="keyword">if</span>(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">authors</span>,inserted <span class="keyword">where</span> authors.au_id=insetted.au_id)!=@<span class="keyword">row</span></div><div class="line">          beign</div><div class="line">            <span class="keyword">rollback</span> <span class="keyword">transaction</span></div><div class="line">            print<span class="string">"对不起，这个au_id在authors主表中不存在。"</span></div><div class="line">          <span class="keyword">end</span></div><div class="line">      <span class="keyword">else</span></div><div class="line">        print<span class="string">"修改titleauthor表成功。"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">go</span></div></pre></td></tr></table></figure>
<p>– 游标及其使用</p>
<pre><code>-- sybase提供了一种称为游标的对象，可以通过游标实现对结果集的按行操作。
-- 游标是一种使用户可以逐行读取select结果集的方法。每个游标都与一个select语句向联系。
游标由俩个位置组成：游标结果集和游标位置。
</code></pre><p>– 在一个应用程序中可以使用俩种类型的游标，服务器端游标和客户端游标。</p>
<pre><code>-- 服务器端游标：是由数据库管理并且容易被客户应用程序开发人员所访问的游标。select语句执行的结果不返回客户端缓冲区中，直到进行游标读取fetch操作时才将相应的一行或几行数据返回客户端。
--客户端游标：是指游标结果集均返回给客户端应用程序缓冲区中。游标从客户端缓冲区中读取数据。在客户端缓冲区中的数据不能及时反映数据库数据的变化。如果应用程序要修改游标当前位置的行，而该行的数据已被其他用户修改（游标打开后修改），则操作失败。
服务器端游标具有客户端游标的全部性能而不需要额外开销或限制。因此在Sybase10或者更高的版本中使用服务器端游标。
</code></pre><p>– 使用游标需要经过说明游标、打开游标、从游标中读取数据、使用游标修改数据、关闭游标及释放游标的步骤。</p>
<p>– 封锁是事务T向系统发送请求，对某个数据库对象加锁。加锁后，事务T就对此数据库有了一定的控制能力，其他事务必须等到事务T释放它的锁之后，才能更新此数据库对象。因此封锁机制可以使多个事务“串行化”。但这些加锁过程并不是由程序员在程序中显示规定的，而是由SQL server的事务管理机制根据事务的结构自动完成的（除holdlock）。</p>
<p>– 有俩种类型的锁，表锁和区间锁。它们锁定的数据比单个数据页的数据多。当用户发出一个不含where子句的update操作请求时，此时出现表锁，使用户可以更新表的每一行。<br>– 当Sybase需要创建一个数据库区间（8页数据）以响应用户的查询时，就会出现区间锁。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.afanail.com/2017/10/21/sql/" data-id="cjiabgto8001zvrypjh9p8lz2" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql-sybase/">sql sybase</a></li></ul>

    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2017/11/09/dataStructor/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          数据结构与算法
        
      </div>
    </a>
  
  
    <a href="/2017/10/01/Perl相关/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">perl-learning</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/11/my-resume/">my resume</a>
          </li>
        
          <li>
            <a href="/2018/04/11/Perl简介/">Perl简介</a>
          </li>
        
          <li>
            <a href="/2018/03/11/微航保技术简介/">菠萝贷技术简介</a>
          </li>
        
          <li>
            <a href="/2018/02/26/Java/">Java</a>
          </li>
        
          <li>
            <a href="/2018/01/25/lookbook/">书单</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2016 - 2018 Afanail&nbsp;
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;zjfapk@163.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>